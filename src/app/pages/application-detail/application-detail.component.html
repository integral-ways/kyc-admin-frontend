<div class="container-fluid p-4 fade-in">
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
    <p class="mt-3 text-muted">Loading application details...</p>
  </div>

  <div *ngIf="!loading && application">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="gradient-text fw-bold mb-1">Application Details</h2>
        <p class="text-muted mb-0">Review and manage customer application</p>
      </div>
      <a routerLink="/applications" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-2"></i> Back to List
      </a>
    </div>

    <!-- Status Banner -->
    <div class="card glass-effect border-0 mb-4">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col-md-8">
            <div class="d-flex align-items-center">
              <div class="avatar-circle-lg me-3">
                {{ getInitials(application.fullName) }}
              </div>
              <div>
                <h4 class="mb-1 fw-bold">{{ application.fullName }}</h4>
                <p class="text-muted mb-0">
                  <i class="bi bi-hash me-1"></i>
                  <code>{{ application.id }}</code>
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-4 text-end">
            <span class="badge fs-6" [ngClass]="getStatusBadgeClass(application.applicationStatus)">
              <i [class]="getStatusIcon(application.applicationStatus)" class="me-2"></i>
              {{ application.applicationStatus }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Left Column - Application Info -->
      <div class="col-lg-8">
        <!-- Basic Information -->
        <div class="card glass-effect border-0 mb-4">
          <div class="card-header">
            <i class="bi bi-person-badge me-2"></i> Basic Information
          </div>
          <div class="card-body">
            <div class="row g-4">
              <div class="col-md-6">
                <div class="info-item">
                  <label class="text-muted small mb-1">
                    <i class="bi bi-person me-1"></i> Full Name
                  </label>
                  <p class="fw-bold mb-0">{{ application.fullName }}</p>
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item">
                  <label class="text-muted small mb-1">
                    <i class="bi bi-envelope me-1"></i> Email Address
                  </label>
                  <p class="mb-0">{{ application.email || 'Not provided' }}</p>
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item">
                  <label class="text-muted small mb-1">
                    <i class="bi bi-phone me-1"></i> Mobile Number
                  </label>
                  <p class="mb-0">
                    <span class="badge bg-light text-dark">{{ application.mobileNumber }}</span>
                  </p>
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item">
                  <label class="text-muted small mb-1">
                    <i class="bi bi-building me-1"></i> Onboarding Type
                  </label>
                  <p class="mb-0">
                    <span class="badge" [class.bg-primary]="application.entityType === 'INDIVIDUAL'" 
                          [class.bg-info]="application.entityType === 'ENTITY'">
                      {{ application.entityType }}
                    </span>
                  </p>
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item">
                  <label class="text-muted small mb-1">
                    <i class="bi bi-calendar me-1"></i> Created At
                  </label>
                  <p class="mb-0">{{ application.createdAt | date:'full' }}</p>
                </div>
              </div>
              <div class="col-md-6">
                <div class="info-item">
                  <label class="text-muted small mb-1">
                    <i class="bi bi-clock-history me-1"></i> Last Updated
                  </label>
                  <p class="mb-0">{{ application.updatedAt | date:'medium' }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Progress Card -->
        <div class="card glass-effect border-0 mb-4">
          <div class="card-header">
            <i class="bi bi-graph-up me-2"></i> Application Progress
          </div>
          <div class="card-body">
            <div class="mb-3">
              <div class="d-flex justify-content-between mb-2">
                <span class="text-muted">Completion Status</span>
                <span class="fw-bold text-primary">{{ application.completionPercentage }}%</span>
              </div>
              <div class="progress" style="height: 20px;">
                <div class="progress-bar" [style.width.%]="application.completionPercentage">
                  {{ application.completionPercentage }}%
                </div>
              </div>
            </div>
            <div class="row g-3 mt-3">
              <div class="col-md-4">
                <div class="text-center p-3 bg-light rounded">
                  <i class="bi bi-list-check fs-3 text-primary"></i>
                  <p class="mb-0 mt-2 text-muted small">Current Step</p>
                  <h5 class="mb-0 fw-bold">{{ application.currentStep }} / 7</h5>
                </div>
              </div>
              <div class="col-md-4">
                <div class="text-center p-3 bg-light rounded">
                  <i class="bi bi-calendar-check fs-3 text-success"></i>
                  <p class="mb-0 mt-2 text-muted small">Submitted</p>
                  <h6 class="mb-0">{{ application.createdAt ? (application.createdAt | date:'short') : 'Not yet' }}</h6>
                </div>
              </div>
              <div class="col-md-4">
                <div class="text-center p-3 bg-light rounded">
                  <i class="bi bi-eye-fill fs-3 text-info"></i>
                  <p class="mb-0 mt-2 text-muted small">Reviewed</p>
                  <h6 class="mb-0">{{ application.reviewedAt ? (application.reviewedAt | date:'short') : 'Not yet' }}</h6>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Review Notes -->
        <div class="card glass-effect border-0" *ngIf="application.reviewNotes">
          <div class="card-header">
            <i class="bi bi-chat-left-text me-2"></i> Review Notes
          </div>
          <div class="card-body">
            <div class="alert alert-info mb-0">
              <i class="bi bi-info-circle me-2"></i>
              {{ application.reviewNotes }}
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column - Actions -->
      <div class="col-lg-4">
        <!-- Actions Card -->
        <div class="card glass-effect border-0 mb-4">
          <div class="card-header">
            <i class="bi bi-gear me-2"></i> Actions
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label class="form-label fw-bold">
                <i class="bi bi-pencil me-1"></i> Review Notes
              </label>
              <textarea class="form-control" rows="4" [(ngModel)]="reviewNotes" 
                        placeholder="Add your review notes here..."></textarea>
              <small class="text-muted">These notes will be saved with the status update</small>
            </div>

            <div class="d-grid gap-2">
              <button class="btn btn-warning btn-lg" (click)="updateStatus('UNDER_REVIEW')" 
                      [disabled]="updating">
                <i class="bi bi-clock-history me-2"></i> 
                <span *ngIf="!updating">Mark Under Review</span>
                <span *ngIf="updating">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Updating...
                </span>
              </button>
              <button class="btn btn-success btn-lg" (click)="updateStatus('APPROVED')" 
                      [disabled]="updating">
                <i class="bi bi-check-circle me-2"></i> 
                <span *ngIf="!updating">Approve Application</span>
                <span *ngIf="updating">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Updating...
                </span>
              </button>
              <button class="btn btn-danger btn-lg" (click)="updateStatus('REJECTED')" 
                      [disabled]="updating">
                <i class="bi bi-x-circle me-2"></i> 
                <span *ngIf="!updating">Reject Application</span>
                <span *ngIf="updating">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Updating...
                </span>
              </button>
            </div>
          </div>
        </div>

        <!-- Assignment Card -->
        <div class="card glass-effect border-0">
          <div class="card-header">
            <i class="bi bi-person-check me-2"></i> Assignment
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label class="form-label">Assigned To</label>
              <p class="fw-bold" *ngIf="application.assignedTo">
                <i class="bi bi-person-circle me-1"></i>
                {{ application.assignedTo }}
              </p>
              <p class="text-muted" *ngIf="!application.assignedTo">
                <i class="bi bi-dash-circle me-1"></i>
                Not assigned
              </p>
            </div>
            <small class="text-muted">
              <i class="bi bi-info-circle me-1"></i>
              Assignment feature coming soon
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.avatar-circle-lg {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 1.5rem;
  box-shadow: 0 4px 6px rgba(99, 102, 241, 0.3);
}

.info-item {
  padding: 0.75rem;
  border-radius: 8px;
  background: #f8fafc;
  transition: all 0.3s ease;
}

.info-item:hover {
  background: #f1f5f9;
  transform: translateX(4px);
}
</style>
